# WordPress REST API Unrestricted File Upload Vulnerability

WordPress REST API &lt;= v5.6 is affected by UFU Vulnerability which allows Cross-Site Scriting (XSS) stored.

## Vulnerability type
File Upload Vulnerability, Cross-Site Scripting (XSS) Vulnerability

## Description of the vulnerability
WordPress is a free and open-source blogging software and content management system (CMS) based on PHP and MySQL. Since version 4.7.0, WordPress has integrated the REST API plugin into its default functionality. The REST API provides users with a convenient and quick management interface.

WordPress REST API versions up to and including 5.6 have a file upload vulnerability. Attackers can exploit this vulnerability via the Media API interface to upload malicious files containing arbitrary JavaScript scripts, thereby carrying out cross-site scripting (XSS) attacks.

## Impact
Attackers can use this vulnerability to execute arbitrary JavaScript code in the victim's browser. 
If the victim has high privileges (such as Administrator), the attacker can create a super administrator account, take over the backend management system.
What's more, the attacker could remotely control the web server, and execute arbitrary code.

## Reproducing the vulnerability
### Forge a Malicious HTML File as a GZIP Type.
First, modify the file name by changing the file extension to .gzip.
Next, modify the file content by appending 8 bytes of a JPG file header to the end of the original file content.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/957bf8ad-9fdf-4371-a9f1-6014e2c3397e)

### An attacker with Author privileges can construct an HTTP request and upload the forged malicious HTML file through the Media API.
The forged file, when uploaded, is identified by WordPress as an application/x-gzip type based on its file extension.
During content inspection, it is identified as an unknown type application/octet-stream.
According to WordPress's code logic, the uploaded file is finally recognized as a normal application/x-gzip type file, bypassing the file upload filtering mechanism and successfully uploading it to the server.
The URL of the uploaded file is returned in the response.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/c99b09ff-d209-4910-94df-25dab72c9c08)

### Trick the victim into visiting the file via the URL, which will execute the JavaScript script in the victim's browser.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/bbcbc7fe-322b-4663-b4a8-db0a135e5295)

### Further Exploitation1:
The attacker writes a JavaScript script to create a super administrator (Administrator) account in the uploaded file.
The attacker then exploits this vulnerability to upload the file to the web server.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/bc0b09d2-1050-4c8c-87fc-6549107f1e14)

### Once a victim with Administrator privileges visits the file via the URL, the script will execute in their browser, using the victim's authentication information to request the creation of a new administrator account.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/6baf5b2a-cd66-4dff-8917-03a679bd96c3)

### The attacker logs in using the newly created Administrator account, successfully taking over the backend system.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/440823e2-835e-4866-8a52-df0fdcfef8dc)

### Further Exploitation2:
The attacker can modify existing PHP files in the backend to include a web shell.
This allows the attacker to control the web server and remotely execute arbitrary PHP code.
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/46b3d964-0fca-47b0-a1b6-821766fcebab)
![image](https://github.com/starrychen1122/WordPress-REST-API-UFU-Vulnerability/assets/57283914/9de5c2b6-6f91-4e27-91ea-745353fca95d)

Successfully Execute System Commands!
